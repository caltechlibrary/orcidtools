{{- define "bibEntry" -}}
{{/* Pull out the remaining fields and map to BibTeX fields if values are not empty */}}
{{- $entryType := (index . "work-type") -}}
{{- $workTitle := (index . "work-title" "title") -}}
{{- $workSubtitle := (index . "work-title" "subtitle") -}}
{{- $entryID := (index . "put-code") -}}
{{- $Journal := (index . "journal-title") -}}


{{- if eq $entryType "JOURNAL_ARTICLE"}}
@Article{ {{- with $entryID -}}{{- . -}},{{- end}}
{{- else}}
@misc{ {{- with $entryID -}}{{- . -}},{{- end}}
{{- end}}
    {{with $Journal}}journal = {{printf "%q" .value}},{{end}}
    {{with $workTitle}}title = {{printf "%q" .value }},{{end}}
    {{with $workSubtitle}}subtitle = {{printf "%q" .value }},{{end}}
}
{{end}}

{{- with .data -}}{{/* 
    1. Reach into the ORCID Profile JSON structure and pull out the works array
    2. For each item in works array format the entry as BibTeX using the bibEntry template
*/}}
{{- range $work := (index . "orcid-profile" "orcid-activities" "orcid-works" "orcid-work") -}}
{{template "bibEntry" $work}}
{{- end -}}
{{- else -}}
No data found
{{- end -}}
